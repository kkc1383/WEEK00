<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="../static/CSS/login.css" />

    <!-- Google Font -->

    <!-- jQuery + Popper.js -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>

    <title>개미와 베짱이</title>

    <style></style>
  </head>

  <body>
    <form id="login-form">
    <div class="container">
      <div class="login-box">
        <img src="../static/images/compassicon.jpg" alt="로고" width="100" height="100" />
        <div class="title">
          <h1>개미와 베짱이</h1>
          <span class="version-box">5팀 강경찬 백준렬 박준성</span>
        </div>

        <!-- 아이디 -->
        <div class="form-group text-left">
          <label for="userid">아이디</label>
          <input id="userid" class="form-control" />
        </div>

        <!-- 비밀번호 -->
        <div class="form-group text-left">
          <label for="password">비밀번호</label>
          <input id="password" type="password" class="form-control" />
        </div>

        <!-- 로그인 버튼 -->
        <button type="submit" class="btn btn-success btn-block login-btn">로그인</button>
      </form>

        <!-- 회원가입 버튼 -->
        <a href="{{ url_for('register') }}" class="btn btn-success btn-block mt-2">회원가입</a>

        <!-- ID/PW 찾기 링크 -->
        <div class="find-links">
          <a href="{{ url_for('find') }}">아이디 / 패스워드 찾기</a>
        </div>
      </div>
    </div>

    <!-- JS: 로그인 함수 -->
    <script>
      function postLogin() {
        let userid = $('#userid').val()
        let password = $('#password').val()
      
        if (!userid || !password) {
          alert('아이디와 비밀번호를 정확히 입력하세요')
          return
        }
        
        if(!localStorage.getItem('access_token')){
          window.location.href="/"
        }
        
        $.ajax({
          type: 'POST',
          url: '/login',
          data: {
            userid_give: userid,
            password_give: password
          },
          success: function (response) {
            console.log(response)
            if (response['result'] === 'success') {
              document.cookie = `access_token=${response['access_token']}; path=/`
              alert('로그인 성공!')
              window.location.href = '/application'
            } else {
              alert('아이디/비밀번호를 확인해주세요!')
            }
          }
        })
      }

        $(document).ready(function () {
          $('#login-form').on('submit', function (e) {
            e.preventDefault(); // 기본 submit 막기
            postLogin();        // 네 기존 함수 호출
          });
        });
    </script>
  </body>
</html>
